@echo off
chcp 65001 > nul
echo ========================================
echo    ????????? GUI ??? Zapret
echo ========================================
echo.

:: ??????? ?????? ??????? ?????? Python
echo [TEST] ????????? ??????????? Python...
python --version >nul 2>&1
if %errorlevel% equ 0 (
    echo [SUCCESS] Python ?????? ????? 'python'
    set "PYTHON_CMD=python"
    goto :install_deps
)

py --version >nul 2>&1
if %errorlevel% equ 0 (
    echo [SUCCESS] Python ?????? ????? 'py'
    set "PYTHON_CMD=py"
    goto :install_deps
)

:: ???? ?? ?????, ?????? ???????????? ??????? ????
echo [INFO] Python ?? ?????? ? PATH. ??????????, ??????? ????:
echo.
echo ???????:
echo - C:\Python312\python.exe
echo - C:\Users\???????\AppData\Local\Programs\Python\Python312\python.exe
echo.
set /p PYTHON_PATH="??????? ?????? ???? ? python.exe: "

if exist "%PYTHON_PATH%" (
    set "PYTHON_CMD=%PYTHON_PATH%"
    goto :install_deps
) else (
    echo [ERROR] ????????? ???? ?? ??????????!
    pause
    exit /b 1
)

:install_deps
echo.
echo [INFO] ????????????? ??????????? ?????????: %PYTHON_CMD%
echo.

echo [1/4] ????????????? pystray...
%PYTHON_CMD% -m pip install pystray
if %errorlevel% neq 0 (
    echo [WARNING] ?????? ????????? pystray, ??????? ? --user...
    %PYTHON_CMD% -m pip install --user pystray
)

echo [2/4] ????????????? pillow...
%PYTHON_CMD% -m pip install pillow
if %errorlevel% neq 0 (
    echo [WARNING] ?????? ????????? pillow, ??????? ? --user...
    %PYTHON_CMD% -m pip install --user pillow
)

echo [3/4] ????????????? pywin32...
%PYTHON_CMD% -m pip install pywin32
if %errorlevel% neq 0 (
    echo [WARNING] ?????? ????????? pywin32, ??????? ? --user...
    %PYTHON_CMD% -m pip install --user pywin32
)

echo [4/4] ????????????? win10toast...
%PYTHON_CMD% -m pip install win10toast
if %errorlevel% neq 0 (
    echo [WARNING] ?????? ????????? win10toast, ??????? ? --user...
    %PYTHON_CMD% -m pip install --user win10toast
)

echo.
echo ========================================
echo    ???????? ?????????
echo ========================================
echo.

%PYTHON_CMD% -c "import pystray; print('? pystray - OK')"
%PYTHON_CMD% -c "from PIL import Image; print('? pillow - OK')" 
%PYTHON_CMD% -c "import win32service; print('? pywin32 - OK')"
%PYTHON_CMD% -c "from win10toast import ToastNotifier; print('? win10toast - OK')"

echo.
echo ========================================
echo    ?????! ??????????? ???????????
echo ========================================
echo.
echo ?????? ????? ????????? GUI:
echo start_gui.bat
echo.
pause